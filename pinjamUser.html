<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buku Dipinjam - Perpustakaan Digital</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        body {
            background-color: #f5f6fa;
        }

        .nav-user {
            font-weight: 500;
        }

        .menu-tabs button {
            border: none;
            background: none;
            padding: 10px 28px;
            font-weight: 500;
        }

        .menu-tabs button:hover {
            background-color: #e5e7eb;
            border-radius: 50px;
        }

        .nav-tab-active {
            background-color: #111827 !important;
            color: white !important;
            border-radius: 50px;
        }

        .active-tab {
            background-color: #111827 !important;
            color: white !important;
        }

        .borrow-card {
            border-radius: 18px;
            padding: 18px;
            border: 1px solid #e5e7eb;
            background: white;
            transition: 0.2s ease;
        }

        .borrow-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .book-cover {
            width: 70px;
            height: 95px;
            object-fit: cover;
            border-radius: 10px;
        }

        .late-badge {
            background: #d90429;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            color: white;
            font-weight: 600;
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar bg-white py-3 shadow-sm">
        <div class="container d-flex justify-content-between align-items-center">

            <!-- LEFT LOGO -->
            <div class="d-flex align-items-center gap-3">
                <div style="
                    width: 40px;
                    height: 40px;
                    background: #0b0f19;
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 18px;">
                    <i class="bi bi-book"></i>
                </div>

                <div>
                    <h5 class="m-0 fw-semibold">Perpustakaan Digital</h5>
                    <small class="text-secondary">Portal Siswa</small>
                </div>
            </div>

            <!-- RIGHT USER INFO -->
            <div class="d-flex align-items-center gap-4 nav-user">

                <div class="d-flex align-items-center gap-2">
                    <div class="user-icon" style="
                        width: 38px; height: 38px; border-radius: 10px;
                        background: #f1f3f5; display:flex; align-items:center; justify-content:center;
                        ">
                        <i class="bi bi-person fs-5"></i>
                    </div>

                    <div class="d-flex flex-column lh-sm">
                        <span class="fw-semibold" id="userName">Ahmad Pratama</span>
                        <span class="text-muted" id="userNis" style="font-size: 12px;">20230001</span>
                    </div>
                </div>

                <a href="javascript:void(0);" onclick="logout()" class="text-decoration-none text-dark fw-semibold">
                    <i class="bi bi-box-arrow-right"></i> Keluar
                </a>
            </div>
        </div>
    </nav>

    <!-- MENU TABS (Style Admin) -->
    <div class="container mt-4">
        <div class="menu-tabs bg-white p-2 rounded-pill shadow-sm d-flex justify-content-around">
            <a href="dashboardUser.html" style="text-decoration:none; color: black;"><button>Jelajahi Buku</button></a>
            <a href="pinjamUser.html" style="text-decoration:none; color: white;"><button class="nav-tab-active">Buku Dipinjam (<span id="pinjamCount">0</span>)</button></a>
        </div>
    </div>

    <!-- JUMBOTRON -->
    <div class="container mt-4">
        <div class="bg-white rounded-4 shadow-sm p-4">

            <h5 class="fw-bold mb-1">Buku yang Sedang Dipinjam</h5>
            <p class="text-secondary mb-4">Daftar buku yang sedang Anda pinjam. Pastikan mengembalikan sebelum jatuh
                tempo.</p>

            <!-- LIST BUKU DIPINJAM -->
            <div class="d-flex flex-column gap-3" id="pinjamList">
                <!-- Data akan dimuat dari localStorage -->
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Load data saat halaman dimuat
        window.addEventListener('load', function() {
            loadPinjamData();
            loadUserInfo();
        });

        // Fungsi load info siswa
        function loadUserInfo() {
            const siswaLogin = localStorage.getItem('siswaLogin');
            
            if (siswaLogin) {
                try {
                    const siswa = JSON.parse(siswaLogin);
                    document.getElementById('userName').textContent = siswa.nama;
                    document.getElementById('userNis').textContent = siswa.nis;
                } catch (error) {
                    console.error('Error loading siswa data:', error);
                    window.location.href = '../../loginSiswa.html';
                }
            } else {
                window.location.href = '../../loginSiswa.html';
            }
        }

        // Fungsi load data peminjaman
        function loadPinjamData() {
            const pinjamList = JSON.parse(localStorage.getItem('pinjamList')) || [];
            const pinjamContainer = document.getElementById('pinjamList');
            const pinjamCount = document.getElementById('pinjamCount');

            // Update jumlah buku dipinjam
            pinjamCount.textContent = pinjamList.length;

            if (pinjamList.length === 0) {
                pinjamContainer.innerHTML = '<div class="alert alert-info">Anda belum meminjam buku apapun.</div>';
                return;
            }

            // Tampilkan setiap buku yang dipinjam
            pinjamList.forEach((pinjam, index) => {
                const returnDate = new Date(pinjam.tanggalKembali);
                const today = new Date();
                const isLate = today > returnDate;

                const pinjamCard = document.createElement('div');
                pinjamCard.className = 'borrow-card d-flex justify-content-between align-items-center';
                pinjamCard.innerHTML = `
                    <div class="d-flex gap-3 flex-grow-1">
                        <img src="https://images.pexels.com/photos/256559/pexels-photo-256559.jpeg" class="book-cover">

                        <div>
                            <h6 class="fw-bold m-0">${pinjam.judul}</h6>
                            <small class="text-secondary d-block mb-2">${pinjam.penulis}</small>

                            <div class="d-flex gap-4 text-secondary small">
                                <span><i class="bi bi-calendar"></i> Dipinjam: ${formatDate(pinjam.tanggalPinjam)}</span>
                                <span><i class="bi bi-clock"></i> Jatuh tempo: ${formatDate(pinjam.tanggalKembali)}</span>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        ${isLate ? '<span class="late-badge">Terlambat</span>' : ''}
                        <button class="btn btn-sm btn-outline-danger" onclick="removeBorrow(${pinjam.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;
                pinjamContainer.appendChild(pinjamCard);
            });
        }

        // Fungsi format tanggal
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Fungsi hapus peminjaman
        function removeBorrow(id) {
            if (confirm('Yakin ingin menghapus peminjaman ini?')) {
                let pinjamList = JSON.parse(localStorage.getItem('pinjamList')) || [];
                pinjamList = pinjamList.filter(p => p.id !== id);
                localStorage.setItem('pinjamList', JSON.stringify(pinjamList));
                loadPinjamData();
            }
        }

        // Fungsi logout
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                localStorage.removeItem('siswaLogin');
                localStorage.removeItem('userRole');
                window.location.href = '../../index.html';
            }
        }
    </script>