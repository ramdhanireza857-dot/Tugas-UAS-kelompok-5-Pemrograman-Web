<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kelola Peminjaman - Sistem Manajemen Perpustakaan</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            background: #f8fafc;
            font-family: system-ui;
        }

        .user-icon {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            background: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-tabs button {
            border: none;
            background: none;
            padding: 10px 28px;
            font-weight: 500;
        }

        .menu-tabs button:hover {
            background: #e5e7eb;
            border-radius: 50px;
        }

        .nav-tab-active {
            background: #111827 !important;
            color: white !important;
            border-radius: 50px;
        }

        .stat-card {
            background: white;
            padding: 22px;
            border-radius: 14px;
            border: 1px solid #e5e7eb;
        }

        .search-card,
        .list-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #e5e7eb;
            padding: 24px;
        }

        .small-muted {
            font-size: 13px;
            color: #6b7280;
        }

        .badge-status {
            padding: 6px 12px;
            border-radius: 14px;
            font-size: 12px;
            color: white;
        }

        .badge-terlambat {
            background: #d90429;
        }

        .badge-dikembalikan {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-kembali {
            background: #0f172a;
            color: white;
            border-radius: 12px;
            padding: 14px 32px;
            font-size: 16px;
            border: none;

            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-kembali:hover {
            opacity: 0.9;
        }

        /* Alignment tabel lebih lega */
        .table> :not(caption)>*>* {
            padding-top: 18px;
            padding-bottom: 18px;
        }

        .table td:last-child,
        .table th:last-child {
            text-align: center;
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar bg-white py-3 shadow-sm">
        <div class="container d-flex justify-content-between align-items-center">

            <div class="d-flex align-items-center gap-3">
                <div
                    style="width:40px;height:40px;background:#111827;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;">
                    <i class="bi bi-shield-lock"></i>
                </div>
                <div>
                    <h5 class="m-0 fw-semibold">Sistem Manajemen Perpustakaan</h5>
                    <small class="text-secondary">Panel Administrator</small>
                </div>
            </div>

            <div class="d-flex align-items-center gap-4">
                <div class="d-flex align-items-center gap-2">
                    <div class="user-icon"><i class="bi bi-person"></i></div>
                    <div class="d-flex flex-column lh-sm">
                        <span class="fw-semibold" id="adminName">Kelompok 5</span>
                        <span class="text-muted" id="adminRole" style="font-size: 12px;">Admin</span>
                    </div>
                </div>
                <a href="../../index.html" class="text-decoration-none text-dark fw-semibold">
                    <i class="bi bi-box-arrow-right"></i> Keluar
                </a>
            </div>
        </div>
    </nav>

    <!-- MENU TABS -->
    <div class="container mt-4">
        <div class="menu-tabs bg-white p-2 rounded-pill shadow-sm d-flex justify-content-around">
            <a href="dashboardAdmin.html" style="text-decoration:none;color:black;">
                <button>Dashboard</button></a>

            <a href="kelolaBukuAdmin.html" style="text-decoration:none;color:black;">
                <button>Kelola Buku</button></a>

            <a href="kelolaSiswaAdmin.html" style="text-decoration:none;color:black;">
                <button>Kelola Siswa</button></a>

            <a href="kelolaPinjamAdmin.html" style="text-decoration:none;color:white;">
                <button class="nav-tab-active">Kelola Peminjaman</button></a>
        </div>
    </div>

    <!-- HEADER -->
    <div class="container mt-4">

        <div class="d-flex justify-content-between">
            <div>
                <h4 class="fw-bold">Manajemen Peminjaman</h4>
                <p class="text-secondary">Kelola proses peminjaman dan pengembalian buku</p>
            </div>

            <button class="btn btn-dark px-4" data-bs-toggle="modal" data-bs-target="#modalTambahPeminjaman">
                <i class="bi bi-plus-lg"></i> Tambah Peminjaman
            </button>
        </div>

        <!-- STAT -->
        <div class="row g-3 mt-1">

            <div class="col-md-3">
                <div class="stat-card">
                    <div class="small-muted">Sedang Dipinjam</div>
                    <h3 class="mt-1 text-primary">2</h3>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stat-card">
                    <div class="small-muted">Terlambat</div>
                    <h3 class="mt-1 text-danger">1</h3>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stat-card">
                    <div class="small-muted">Sudah Dikembalikan</div>
                    <h3 class="mt-1 text-success">1</h3>
                </div>
            </div>

            <div class="col-md-3">
                <div class="stat-card">
                    <div class="small-muted">Total Denda</div>
                    <h4 class="mt-1 text-danger fw-bold">Rp 5.000</h4>
                </div>
            </div>

        </div>

        <!-- SEARCH FILTER -->
        <div class="search-card mt-4">
            <div class="row g-3 align-items-center">
                <div class="col-md-9">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="bi bi-search text-muted"></i></span>
                        <input type="search" class="form-control"
                            placeholder="Cari berdasarkan nama siswa, judul buku, atau NIM...">
                    </div>
                </div>

                <div class="col-md-3">
                    <select class="form-select">
                        <option selected>Semua Status</option>
                        <option value="1">Dipinjam</option>
                        <option value="2">Dikembalikan</option>
                        <option value="3">Terlambat</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- TABLE RIWAYAT -->
        <div class="list-card mt-4">
            <h6 class="fw-bold">Riwayat Peminjaman (4)</h6>
            <p class="small-muted">Daftar semua transaksi peminjaman dan pengembalian buku</p>

            <div class="table-responsive mt-3">
                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th>Siswa</th>
                            <th>Buku</th>
                            <th>Tanggal Pinjam</th>
                            <th>Jatuh Tempo</th>
                            <th>Tanggal Kembali</th>
                            <th>Status</th>
                            <th>Denda</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>

                    <tbody>

                        <!-- 1 -->
                        <tr>
                            <td><div class="fw-semibold">Ahmad Pratama</div></td>
                            <td>Pemrograman Web Modern dengan React</td>
                            <td>15/1/2024</td>
                            <td class="text-danger fw-semibold">29/1/2024</td>
                            <td>-</td>
                            <td><span class="badge-status badge-terlambat">Terlambat</span></td>
                            <td>-</td>
                            <td>
                                <button class="btn-kembali">
                                    <i class="bi bi-arrow-return-left"></i> Kembalikan
                                </button>
                            </td>
                        </tr>

                        <!-- 2 -->
                        <tr>
                            <td><div class="fw-semibold">Sari Indah</div></td>
                            <td>Database Design and Management</td>
                            <td>10/1/2024</td>
                            <td class="text-danger fw-semibold">24/1/2024</td>
                            <td class="text-success fw-semibold">22/1/2024</td>
                            <td><span class="badge-dikembalikan">Dikembalikan</span></td>
                            <td>-</td>
                            <td><span class="invisible">btn</span></td>
                        </tr>

                        <!-- 3 -->
                        <tr>
                            <td><div class="fw-semibold">Budi Santoso</div></td>
                            <td>Machine Learning untuk Pemula</td>
                            <td>5/1/2024</td>
                            <td class="text-danger fw-semibold">19/1/2024</td>
                            <td>-</td>
                            <td><span class="badge-status badge-terlambat">Terlambat</span></td>
                            <td class="text-danger fw-semibold">Rp 5.000</td>
                            <td><span class="invisible">btn</span></td>
                        </tr>

                        <!-- 4 -->
                        <tr>
                            <td><div class="fw-semibold">Ahmad Pratama</div></td>
                            <td>Algoritma dan Struktur Data</td>
                            <td>12/1/2024</td>
                            <td class="text-danger fw-semibold">26/1/2024</td>
                            <td>-</td>
                            <td><span class="badge-status badge-terlambat">Terlambat</span></td>
                            <td>-</td>
                            <td>
                                <button class="btn-kembali">
                                    <i class="bi bi-arrow-return-left"></i> Kembalikan
                                </button>
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div style="height:40px;"></div>

    <!-- MODAL TAMBAH PEMINJAMAN -->
    <div class="modal fade" id="modalTambahPeminjaman" tabindex="-1" aria-labelledby="modalTambahPeminjamanLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="modalTambahPeminjamanLabel">Tambah Peminjaman Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formTambahPeminjaman">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="namaSiswa" class="form-label fw-bold">Nama Siswa</label>
                                <select class="form-select" id="namaSiswa" required>
                                    <option selected disabled>Pilih siswa</option>
                                    <option>Ahmad Pratama</option>
                                    <option>Sari Indah</option>
                                    <option>Budi Santoso</option>
                                    <option>Rina Permata</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="namaBuku" class="form-label fw-bold">Nama Buku</label>
                                <select class="form-select" id="namaBuku" required>
                                    <option selected disabled>Pilih buku</option>
                                    <option>Pemrograman Web Modern dengan React</option>
                                    <option>Database Design and Management</option>
                                    <option>Machine Learning untuk Pemula</option>
                                    <option>Algoritma dan Struktur Data</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="tanggalPinjam" class="form-label fw-bold">Tanggal Peminjaman</label>
                                <input type="date" class="form-control" id="tanggalPinjam" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="tanggalKembali" class="form-label fw-bold">Tanggal Jatuh Tempo</label>
                                <input type="date" class="form-control" id="tanggalKembali" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="durasi" class="form-label fw-bold">Durasi Peminjaman (Hari)</label>
                            <input type="number" class="form-control" id="durasi" placeholder="14" min="1" max="30" required>
                        </div>

                        <div class="mb-3">
                            <label for="status" class="form-label fw-bold">Status Peminjaman</label>
                            <select class="form-select" id="status" required>
                                <option selected disabled>Pilih status</option>
                                <option selected>Sedang Dipinjam</option>
                                <option>Terlambat</option>
                                <option>Dikembalikan</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="keterangan" class="form-label fw-bold">Keterangan</label>
                            <textarea class="form-control" id="keterangan" rows="2" placeholder="Masukkan keterangan (opsional)"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-dark" onclick="tambahPeminjaman()">Simpan Peminjaman</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT BOOTSTRAP -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- SCRIPT TAMBAH PEMINJAMAN -->
    <script>
        // Data siswa yang tersimpan
        let daftarSiswa = [
            { nama: 'Ahmad Pratama', nis: '20230001' },
            { nama: 'Sari Indah', nis: '20230002' },
            { nama: 'Budi Santoso', nis: '20220015' },
            { nama: 'Rina Permata', nis: '20230025' }
        ];

        // Data buku yang tersimpan
        let daftarBuku = [
            'Pemrograman Web Modern dengan React',
            'Database Design and Management',
            'Machine Learning untuk Pemula',
            'Algoritma dan Struktur Data'
        ];

        // Set tanggal hari ini sebagai default
        document.addEventListener('DOMContentLoaded', function() {
            const hari = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalPinjam').value = hari;
            
            // Populate dropdown siswa dari localStorage atau data default
            loadSiswaKeDropdown();
            loadBukuKeDropdown();
        });

        function loadSiswaKeDropdown() {
            const selectSiswa = document.getElementById('namaSiswa');
            
            // Cek apakah ada data siswa di localStorage
            const siswaTersimpan = localStorage.getItem('daftarSiswa');
            if (siswaTersimpan) {
                try {
                    daftarSiswa = JSON.parse(siswaTersimpan);
                } catch (e) {
                    console.log('Menggunakan data siswa default');
                }
            }

            // Hapus option lama kecuali yang pertama
            while (selectSiswa.options.length > 1) {
                selectSiswa.remove(1);
            }

            // Tambahkan siswa dari daftar
            daftarSiswa.forEach(siswa => {
                const option = document.createElement('option');
                option.value = siswa.nama;
                option.textContent = siswa.nama;
                selectSiswa.appendChild(option);
            });
        }

        function loadBukuKeDropdown() {
            const selectBuku = document.getElementById('namaBuku');
            
            // Cek apakah ada data buku di localStorage
            const bukuTersimpan = localStorage.getItem('daftarBuku');
            if (bukuTersimpan) {
                try {
                    daftarBuku = JSON.parse(bukuTersimpan);
                } catch (e) {
                    console.log('Menggunakan data buku default');
                }
            }

            // Hapus option lama kecuali yang pertama
            while (selectBuku.options.length > 1) {
                selectBuku.remove(1);
            }

            // Tambahkan buku dari daftar
            daftarBuku.forEach(buku => {
                const option = document.createElement('option');
                option.value = buku;
                option.textContent = buku;
                selectBuku.appendChild(option);
            });
        }

        function tambahPeminjaman() {
            // Ambil data dari form
            const namaSiswa = document.getElementById('namaSiswa').value;
            const namaBuku = document.getElementById('namaBuku').value;
            const tanggalPinjam = document.getElementById('tanggalPinjam').value;
            const tanggalKembali = document.getElementById('tanggalKembali').value;
            const durasi = document.getElementById('durasi').value;
            const status = document.getElementById('status').value;
            const keterangan = document.getElementById('keterangan').value;

            // Validasi input
            if (!namaSiswa || !namaBuku || !tanggalPinjam || !tanggalKembali || !durasi || !status) {
                alert('Semua field yang bertanda * harus diisi!');
                return;
            }

            // Validasi tanggal
            const pinjam = new Date(tanggalPinjam);
            const kembali = new Date(tanggalKembali);
            if (kembali <= pinjam) {
                alert('Tanggal jatuh tempo harus lebih besar dari tanggal peminjaman!');
                return;
            }

            // Format tanggal
            const formatTanggal = (date) => {
                return date.toLocaleDateString('id-ID', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit' 
                });
            };

            // Buat baris tabel baru
            const tabelBody = document.querySelector('table tbody');
            const newRow = document.createElement('tr');

            // Tentukan badge status
            let badgeStatus = '';
            let tanggalDikembalikan = '-';
            let denda = '-';
            let btnKembali = '<span class="invisible">btn</span>';

            if (status === 'Sedang Dipinjam') {
                badgeStatus = '<span class="badge-status" style="background: #3b82f6;">Sedang Dipinjam</span>';
                btnKembali = '<button class="btn-kembali" onclick="kembalikanBuku(this)"><i class="bi bi-arrow-return-left"></i> Kembalikan</button>';
            } else if (status === 'Terlambat') {
                badgeStatus = '<span class="badge-status badge-terlambat">Terlambat</span>';
                denda = '<span class="text-danger fw-semibold">Rp 5.000</span>';
            } else if (status === 'Dikembalikan') {
                badgeStatus = '<span class="badge-dikembalikan">Dikembalikan</span>';
                tanggalDikembalikan = formatTanggal(new Date());
            }

            newRow.innerHTML = `
                <td><div class="fw-semibold">${namaSiswa}</div></td>
                <td>${namaBuku}</td>
                <td>${formatTanggal(pinjam)}</td>
                <td class="text-danger fw-semibold">${formatTanggal(kembali)}</td>
                <td>${tanggalDikembalikan}</td>
                <td>${badgeStatus}</td>
                <td>${denda}</td>
                <td>${btnKembali}</td>
            `;

            // Tambahkan baris ke tabel
            tabelBody.appendChild(newRow);

            // Update statistik
            updateStatistikPeminjaman();

            // Reset form
            document.getElementById('formTambahPeminjaman').reset();

            // Tutup modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalTambahPeminjaman'));
            modal.hide();

            // Tampilkan notifikasi sukses
            alert('Peminjaman berhasil ditambahkan!');
        }

        function kembalikanBuku(btn) {
            if (confirm('Apakah buku ini sudah dikembalikan?')) {
                const row = btn.closest('tr');
                // Update status menjadi dikembalikan
                row.cells[5].innerHTML = '<span class="badge-dikembalikan">Dikembalikan</span>';
                
                // Update tanggal dikembalikan
                const hariIni = new Date().toLocaleDateString('id-ID', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit' 
                });
                row.cells[4].textContent = hariIni;
                
                // Ganti tombol dengan teks
                row.cells[7].innerHTML = '<span class="invisible">btn</span>';
                
                updateStatistikPeminjaman();
                alert('Buku berhasil dikembalikan!');
            }
        }

        function updateStatistikPeminjaman() {
            const rows = document.querySelectorAll('table tbody tr');
            let sedangDipinjam = 0;
            let terlambat = 0;
            let sudahDikembalikan = 0;

            rows.forEach(row => {
                const statusBadge = row.cells[5].textContent.trim();
                if (statusBadge.includes('Sedang Dipinjam')) {
                    sedangDipinjam++;
                } else if (statusBadge.includes('Terlambat')) {
                    terlambat++;
                } else if (statusBadge.includes('Dikembalikan')) {
                    sudahDikembalikan++;
                }
            });

            // Update stat cards
            const statCards = document.querySelectorAll('.stat-card h3');
            if (statCards.length >= 3) {
                statCards[0].textContent = sedangDipinjam;
                statCards[1].textContent = terlambat;
                statCards[2].textContent = sudahDikembalikan;
            }
        }
    </script>

</body>

</html>
